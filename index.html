<!-- FILEPATH: /C:/Users/sande/OneDrive/Documents/School/TCSS 445/445_Project_Sanders_delCastillo.html -->
<!-- BEGIN: abpxx6d04wxr -->
<html>
<head>
    <title>Record Store</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.1/sql-wasm.js"></script>
</head>
<body>
<!--nav bar-->
<header>
    <nav>
        <h1>Record Store</h1>
        <div id="login-sign-up-div">
            <button type="button" id="loginbtn">Login</button>
            <p id="sign-up-text">or <span id="sign-upbtn">Sign up</span></p>
            <p  id="logoutbtn" style="display: none;">You are logged in <br><span id="logout-span"><strong>Logout</strong></span></p>
        </div>
    </nav>
</header>
<div id="login-box" style="display: none;">
    <input type="text" id="login-input" placeholder="Email or Phone">
</div>
<div id="sign-up-box" style="display: none;">
    <input type="text" id="fname-input" placeholder="First name">
    <input type="text" id="lname-input" placeholder="Last name">
    <input type="text" id="email-input" placeholder="Email">
    <input type="text" id="phone-input" placeholder="Phone Number">
</div>
<div id="search-bar">
    <input type="text" id="search-input" placeholder="Search">
    <select id="filter">
        <option value="Title">Title</option>
        <option value="Artist">Artist</option>
        <option value="Album">Album</option>
        <option value="Genre">Genre</option>
        <option value="Year">Year</option>
    </select>
    <button type="button" id="search-btn">Search</button>
    <br>
    <br>
    <p id="total">Total: $0.00</p>
    <button type="button" id="checkout">Checkout</button>
</div>
<div id="employee-controls">
    <h3>Employee Controls</h3>
    <select id="employee-controls-dropdown">
        <option value="select">Select</option>
        <option value="add-record">Add Record</option>
        <option value="search-customers">Search Customers</option>
        <option value="search-sales">Search Sales</option>
    </select>
    <div id="add-record" style="display: none;">
        <input type="text" id="title-input" placeholder="Title">
        <input type="text" id="artist-input" placeholder="Artist">
        <input type="text" id="album-input" placeholder="Album">
        <br>
        <input type="text" id="genre-input" placeholder="Genre">
        <input type="text" id="year-input" placeholder="Year">
        <input type="text" id="price-input" placeholder="Price">
        <button type="button" id="add-recordbtn">Add Record</button>
    </div>
    <div id="search-customers" style="display: none;">
        <input type="text" id="customer-input" placeholder="Search">
        <button type="button" id="search-customersbtn">Search Customers</button>
    </div>
    <div id="search-sales" style="display: none;">
        <input type="text" id="sales-input" placeholder="Search">
        <button type="button" id="search-salesbtn">Search Sales</button>
    </div>
</div>
<table id="records-table">
    <tbody id="records-table-body">
        <tr>
            <td class="record-tile">
                <h2 id="record-title">Title</h2>
                <button type="button" id="delete-recordbtn">Delete</button>
                <p id="record-price">$19.99</p>
                <p id="record-artist">Artist</p>
                <p id="record-genre">Genre</p>
                <br><br>
                <p id="record-album">Album</p>
                <p id="record-year">Year</p>
                <button type="button" id="record-cartbtn">Add to Cart</button>
            </td>
        </tr>
        <tr>
            <td class="record-tile">
                <h2 id="record-title">Title</h2>
                <button type="button" id="delete-recordbtn">Delete</button>
                <p id="record-price">$19.99</p>
                <p id="record-artist">Artist</p>
                <p id="record-genre">Genre</p>
                <br><br>
                <p id="record-album">Album</p>
                <p id="record-year">Year</p>
                <button type="button" id="record-cartbtn">Add to Cart</button>
            </td>
        </tr>
        <tr>
            <td class="record-tile">
                <h2 id="record-title">Title</h2>
                <button type="button" id="delete-recordbtn">Delete</button>
                <p id="record-price">$19.99</p>
                <p id="record-artist">Artist</p>
                <p id="record-genre">Genre</p>
                <br><br>
                <p id="record-album">Album</p>
                <p id="record-year">Year</p>
                <button type="button" id="record-cartbtn">Add to Cart</button>
            </td>
        </tr>
        <tr>
            <td class="record-tile">
                <h2 id="record-title">Title</h2>
                <button type="button" id="delete-recordbtn">Delete</button>
                <p id="record-price">$19.99</p>
                <p id="record-artist">Artist</p>
                <p id="record-genre">Genre</p>
                <br><br>
                <p id="record-album">Album</p>
                <p id="record-year">Year</p>
                <button type="button" id="record-cartbtn">Add to Cart</button>
            </td>
        </tr>
    </tbody>
</table>
<style>
</style>
<script>
    
    document.getElementById('loginbtn').addEventListener('click', function() {
        if (document.getElementById('login-box').style.display != 'none') {
            alert('SELECT * FROM Customers WHERE email = \'' + document.getElementById('login-input').value + '\' OR phone = \'' + document.getElementById('login-input').value + '\' AND is_deleted = 0;');
            document.getElementById('loginbtn').style.visibility = 'hidden';
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('sign-up-text').style.display = 'none';
            document.getElementById('logoutbtn').style.display = 'block';
        } else {
            document.getElementById('sign-up-box').style.display = 'none';
            document.getElementById('login-box').style.display = 'block';
        }
    });
    
    document.getElementById('sign-upbtn').addEventListener('click', function() {
        if (document.getElementById('sign-up-box').style.display != 'none') {
            alert('INSERT INTO Users (fname, lname, email, phone) VALUES (\'' + document.getElementById('fname-input').value + '\', \'' + document.getElementById('lname-input').value + '\', \'' + document.getElementById('email-input').value + '\', \'' + document.getElementById('phone-input').value + '\');');
            document.getElementById('loginbtn').style.visibility = 'hidden';
            document.getElementById('sign-up-box').style.display = 'none';
            document.getElementById('sign-up-text').style.display = 'none';
            document.getElementById('logoutbtn').style.display = 'block';
        } else {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('sign-up-box').style.display = 'block';
        }
    });

    document.getElementById('logoutbtn').addEventListener('click', function() {
        document.getElementById('loginbtn').style.visibility = 'visible';
        document.getElementById('sign-up-text').style.display = 'block';
        document.getElementById('logoutbtn').style.display = 'none';
    });
    
    document.getElementById('search-btn').addEventListener('click', function() {
        // Display the popup
        alert('SELECT * FROM Records WHERE ' + document.getElementById('filter').value + ' LIKE \'%' + document.getElementById('search-input').value + '%\' AND is_deleted = 0;');
    });

    // document.getElementById('record-cartbtn').addEventListener('click', function() {
    //     alert(this.parentElement.value);
    // });

    document.querySelectorAll('#record-cartbtn').forEach(button => {
        button.addEventListener('click', function(event) {
            const recordTile = event.target.closest('.record-tile'); // Find the closest parent element with class .record-tile
            const recordTitle = recordTile.querySelector('#record-title').textContent; // Find the title element within the record tile
            const recordPrice = recordTile.querySelector('#record-price').textContent; // Find the price element within the record tile

            alert(recordTitle + ' added to cart');
            document.getElementById('total').textContent = 'Total: $' + (parseFloat(document.getElementById('total').textContent.split('$')[1]) + parseFloat(recordPrice.split('$')[1])).toFixed(2);
        });
    });

    document.querySelectorAll('#delete-recordbtn').forEach(button => {
        button.addEventListener('click', function(event) {
            const recordTile = event.target.closest('.record-tile'); // Find the closest parent element with class .record-tile
            const recordTitle = recordTile.querySelector('#record-title').textContent; // Find the title element within the record tile

            alert('UPDATE Records SET is_deleted = 1 WHERE title = \'' + recordTitle + '\';');
            recordTile.remove();
        });
    });


    // Add a click event listener to the button
    document.getElementById('checkout').addEventListener('click', function() {
        // Display the popup
        alert('Checkout \nTotal: ' + document.getElementById('total').textContent.split('$')[1]);
        document.getElementById('total').textContent = 'Total: $0.00';
    });

    document.getElementById('employee-controls-dropdown').addEventListener('change', function() {
    // Get the selected value of the dropdown
    var selectedOption = this.value;
    // Hide all options
    document.getElementById('add-record').style.display = 'none';
    document.getElementById('search-customers').style.display = 'none';
    document.getElementById('search-sales').style.display = 'none';

    // Show the selected option
    document.getElementById(selectedOption).style.display = 'block';
});

document.getElementById('add-recordbtn').addEventListener('click', function() {
    // Get the input values
    const title = document.getElementById('title-input').value;
    const artist = document.getElementById('artist-input').value;
    const album = document.getElementById('album-input').value;
    const genre = document.getElementById('genre-input').value;
    const year = document.getElementById('year-input').value;
    const price = document.getElementById('price-input').value;

    // Display the popup
    alert('INSERT INTO Records (title, artist, album, genre, year, price) VALUES (\'' + title + '\', \'' + artist + '\', \'' + album + '\', \'' + genre + '\', \'' + year + '\', \'' + price + '\');');
});

document.getElementById('search-customersbtn').addEventListener('click', function() {
    // Get the input value
    const customer = document.getElementById('customer-input').value;

    // Display the popup
    alert('SELECT * FROM Users WHERE customerid LIKE \'%' + customer + '%\' OR fname LIKE \'%' + customer + '%\' OR lname LIKE \'%' + customer + '%\' OR phone LIKE \'%' + customer + '%\' OR email LIKE \'%' + customer + '%\' AND is_deleted = 0;');
});

document.getElementById('search-salesbtn').addEventListener('click', function() {
    // Get the input value
    const sales = document.getElementById('sales-input').value;

    // Display the popup
    alert('SELECT * FROM Sales WHERE sale_id LIKE \'%' + sales + '%\' OR buyer_id LIKE \'%' + sales + '%\' OR record_id LIKE \'%' + sales + '%\' OR date LIKE \'%' + sales + '%\' OR price LIKE \'%' + sales + '%\' OR quantity LIKE \'%' + sales + '%\';');
});

async function loadAndQueryDatabase() {
            // Load the SQLite database file
            const response = await fetch('/root/Sanders_delCastillo_Queries.sql');
            const arrayBuffer = await response.arrayBuffer();
            const db = new SQL.Database(new Uint8Array(arrayBuffer));
            //cors policy


            // Execute SQL query
            const query = 'SELECT * FROM Customers';
            const resultSet = db.exec(query);

            // Display the results
            const outputDiv = document.getElementById('output');
            resultSet[0].values.forEach(row => {
                outputDiv.innerHTML += `<p>${row.join(' | ')}</p>`;
            });
        }

        // Call the function when the page is loaded
        window.onload = loadAndQueryDatabase;



// const sqlite3 = require('sqlite3').verbose();

// // Open a database connection
// let db = new sqlite3.Database('Sanders_delCastillo_Queries.sql', sqlite3.OPEN_READWRITE, (err) => {
//     if (err) {
//         console.error(err.message);
//     }
//     console.log('Connected to the database.');
// });

// // Define your SQL query to retrieve data
// let sql = `SELECT * FROM Customers WHERE is_deleted = 0`;

// // Execute the query
// db.all(sql, [], (err, rows) => {
//     if (err) {
//         throw err;
//     }
//     // Process the rows retrieved from the database
//     rows.forEach((row) => {
//         console.log(row); // You can display or process the data as needed
//     });
// });

// // Close the database connection
// db.close((err) => {
//     if (err) {
//         console.error(err.message);
//     }
//     console.log('Close the database connection.');
// });

    
// const mysql = require('mysql');

// // Create a connection
// const connection = mysql.createConnection({
//     host: 'localhost',
//     user: 'your_username',
//     password: 'your_password',
//     database: 'your_database'
// });

// // Connect to the database
// connection.connect((err) => {
//     if (err) {
//         console.error('Error connecting to the database:', err);
//         return;
//     }
//     console.log('Connected to the database');
// });

// // Perform database operations
// // ...

// // Close the connection
// connection.end((err) => {
//     if (err) {
//         console.error('Error closing the database connection:', err);
//         return;
//     }
//     console.log('Connection closed');
// });

//     // Search for records
//     document.getElementById('search-btn').addEventListener('click', function() {
//         // Get the search query from the input field
//         const filter = document.getElementById('filter').value;
//         const searchQuery = document.getElementById('search-input').value;
//         connection.query('SELECT * FROM Records WHERE ' + searchFiliter + ' LIKE ?', '%' + searchQuery + '%', (err, rows) => {
//             if (err) {
//                 console.error('Error executing the query:', err);
//                 return;
//             }
//             console.log('Search results:', rows);
//             // Display the search results on the page
//             // ...
//     // Fetch records from the database
//     connection.query('SELECT * FROM Records', (err, rows) => {
//         if (err) {
//             console.error('Error fetching records:', err);
//             return;
//         }
        
//         // Get the table body element
//         const tableBody = document.getElementById('records-table-body');
        
//         // Clear existing table rows
//         tableBody.innerHTML = '';
        
//         // Generate HTML markup for each record
//         rows.forEach((record) => {
//             const row = document.createElement('tr');
            
//             const recordTile = document.createElement('td');
//             const recordTitle = document.createElement('h2');
//             const recordArtist = document.createElement('p');
//             const recordAlbum = document.createElement('p');
//             const recordGenre = document.createElement('p');
//             const recordPrice = document.createElement('p');
//             const addBtn = document.createElement('button');
            
//             recordTitle.textContent = 'Record Title';
//             recordArtist.textContent = 'Record Artist';
//             recordAlbum.textContent = 'Record Album';
//             recordGenre.textContent = 'Record Genre';
//             recordPrice.textContent = 'Record Price';

//             addBtn.textContent = 'Add to Cart'; // Add a click event listener to the button
//             addBtn.addEventListener('click', function() {
//                 // Add the record to the cart
//                 alert('Record added to cart');
//             });

//             recordTile.appendChild(recordTitle);
//             recordTile.appendChild(recordArtist);
//             recordTile.appendChild(recordAlbum);
//             recordTile.appendChild(recordGenre);
//             recordTile.appendChild(recordPrice);
//             recordTile.appendChild(addBtn);
//             row.appendChild(recordTile);          
//             tableBody.appendChild(row);
            
//         });
//     });
//         });
//     });

//     // Insert a new record
//     const newRecord = { name: 'John Doe', age: 25, email: 'johndoe@example.com' };
//     connection.query('INSERT INTO Records SET ?', newRecord, (err, result) => {
//         if (err) {
//             console.error('Error inserting a new record:', err);
//             return;
//         }
//         console.log('New record inserted:', result);
//     });

//     // Delete a record
//     connection.query('DELETE FROM Records WHERE id = ?', [1], (err, result) => {
//         if (err) {
//             console.error('Error deleting a record:', err);
//             return;
//         }
//         console.log('Record deleted:', result);
//     });

//     // Update an existing record
//     const updatedRecord = { name: 'Jane Doe', age: 30, email: 'janedoe@example.com' };
//     const recordId = 1; // Assuming you want to update the record with id 1
//     connection.query('UPDATE Records SET ? WHERE id = ?', [updatedRecord, recordId], (err, result) => {
//         if (err) {
//             console.error('Error updating the record:', err);
//             return;
//         }
//         console.log('Record updated:', result);
//     });


</script>
</body>
</html>
